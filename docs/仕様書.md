# Crypto Relative Strength Tracker 仕様書

このドキュメントは、`my-crypto-watch` の実装仕様をまとめたものです。

## 1. 目的
推しコインが主要暗号資産に対して相対的にどれだけ強い／弱いかを、複数時間軸で可視化する。

## 2. 技術スタック
- Next.js (App Router)
- TypeScript
- Tailwind CSS
- Recharts
- CoinMarketCap API (Free Basic)

## 3. ディレクトリ構成
```
my-crypto-watch/
├── .env.local
├── next.config.ts
├── tailwind.config.ts
├── src/
│   ├── app/
│   │   ├── layout.tsx
│   │   ├── page.tsx
│   │   ├── globals.css
│   │   └── api/
│   │       └── crypto/
│   │           ├── listings/route.ts
│   │           └── quotes/route.ts
│   ├── components/
│   │   ├── Header.tsx
│   │   ├── CoinSelector.tsx
│   │   ├── CoinCard.tsx
│   │   ├── BenchmarkSelector.tsx
│   │   ├── TimeframeToggle.tsx
│   │   ├── StrengthGauge.tsx
│   │   ├── RelativeStrengthChart.tsx
│   │   └── RelativeStrengthTable.tsx
│   ├── hooks/
│   │   └── useCryptoData.ts
│   └── lib/
│       ├── cmc-client.ts
│       ├── calculations.ts
│       └── types.ts
└── docs/
    ├── 説明書.md
    └── 仕様書.md
```

## 4. 環境変数
- `CMC_API_KEY` (必須)
- `CACHE_REVALIDATE_SECONDS` (任意、デフォルト 300)
- `EXCHANGE_RATE_API_KEY` (ExchangeRate-API 用)

## 5. API設計

### 5.1 `/api/crypto/listings`
- CoinMarketCap `/v1/cryptocurrency/listings/latest` をプロキシ
- `limit` と `convert` を受け付ける
- レスポンスは必要フィールドのみ返却

### 5.2 `/api/crypto/quotes`
- CoinMarketCap `/v1/cryptocurrency/quotes/latest` をプロキシ
- `symbols` パラメータ必須

### 5.3 `/api/fx/latest`
- ExchangeRate-API `/v6/{key}/latest/USD` を利用
- `symbols` パラメータで対象通貨を指定
- JPY換算の価格と変動率（1h/24h/7d/30d/90d）を返す

## 6. キャッシュ方針
- `fetch` の `next.revalidate` を利用
- デフォルトで5分キャッシュ

## 7. 相対強度計算

### 7.1 RPD
```
RPD = 推しコイン変動率 - 対象銘柄変動率
```

### 7.2 Composite
```
Composite = 対象銘柄とのRPD平均
```

### 7.3 重み付き総合
```
1h: 0.05
24h: 0.15
7d: 0.25
30d: 0.30
90d: 0.25
```

## 8. 状態管理
`useCryptoData` に全状態を集約。

- listings
- isLoading
- error
- lastUpdated
- oshiCoin
- preset
- customBenchmarks
- selectedTimeframe
- benchmarkCoins
- relativeStrengths
- compositeScore
- multiTimeframeStrength

## 9. UI仕様
- ダークネイビー基調
- 背景はグラデーション
- 推しコインはアンバーで強調
- 相対強度バーチャートに「推しが強い/弱い」ラベルを表示
- 主要法定通貨プリセットを追加

## 10. 免責表示
- 「本アプリは投資助言を目的としたものではありません」を画面下部に表示

## 11. 既知の制約
- CMC Free Plan のレート制限あり
- OHLCVなどのヒストリカルは未対応
- ExchangeRate-API Free は日次更新のため、短期変動率は精度が低い
